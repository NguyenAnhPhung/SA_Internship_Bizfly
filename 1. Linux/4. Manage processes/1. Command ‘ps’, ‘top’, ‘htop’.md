# Command ‘ps’, ‘top’, ‘htop’

## 1. ps

tham khảo tại [tecmint](https://www.tecmint.com/ps-command-examples-for-linux-process-monitoring/)

tham khảo tại [vietnix.vn](https://vietnix.vn/lenh-ps-trong-linux/)

Lệnh ps được dùng để xem thông tin về các tiến trình đang chạy trên hệ thống. Lệnh này đọc thông tin từ các tệp ảo trong hệ thống tệp /proc

### Các option của lệnh `ps`

#### 1. Chạy ps mặc định

- nó sẽ hiển thị các tiến trình cho shell hiện tại 

#### 2. Liệt kê tất cả các tiến trình trong hệ thống 

- `-A` hoặc `-e`
- Để in process tree dùng `-eH` hoặc `-e --forest`

#### 3. `ps au`, `ps -axu` hiển thị tiến trình theo định dạng BSD

#### Sự khác nhau giữa `ps au` và `ps axu`

- **`ps au`**: Chỉ hiển thị các tiến trình có kết nối với một terminal (TTY) của tất cả người dùng.
- **`ps axu`**: Hiển thị tất cả các tiến trình của tất cả người dùng, bao gồm cả những tiến trình không có kết nối với một terminal (TTY).

tóm lại
ps au : sẽ liệt kê danh sách các tiến trình có tty

ps axu: liệt kê tất cả các tiến trình có, và không có tty

TTY là gì? 

Lệnh này sẽ trả về một bảng bao gồm các cột như sau:

- **USER**: Tên người dùng sở hữu tiến trình.
- **PID**: ID của tiến trình.
- **%CPU**: Phần trăm CPU mà tiến trình sử dụng.
- **%MEM**: Phần trăm bộ nhớ RAM mà tiến trình sử dụng.
- **VSZ**: Kích thước bộ nhớ ảo của tiến trình.
- **RSS**: Kích thước bộ nhớ thực của tiến trình.
- **TTY**: Terminal được liên kết với tiến trình (hoặc '?' nếu không có terminal).
- **STAT**: Trạng thái của tiến trình (R = running, S = sleeping, T = stopped, Z = zombie).
- **START**: Thời gian khởi động của tiến trình.
- **TIME**: Tổng thời gian CPU mà tiến trình đã sử dụng.
- **COMMAND**: Lệnh hoặc chương trình được chạy để khởi tạo tiến trình.

#### 4. `-f` liệt kê chi tiết tiến trình 

```
ps -ef
```

#### 5. `ps -x` hiển thị các ps của người dùng 

- hiển thị ps của người dùng hiện tại

  ```
  ps -x
  ```

- hiển thị tiến trình của người dùng cụ thể 

```
ps -fU <tên user>
```



#### 6. `-fG` liệt kê các tiến trình dựa trên nhóm

để liệt kê ps của nhóm cụ  thể 

```
ps -fG <tên nhóm>
```

#### 7. `-o` Tạo định dạng đầu ra tuy chỉnh

```
$ ps -eo pid,ppid,user,cmd
```

tại sao lại là `ps -eo` ?

tùy chọn `-e` ở đây để liệt kê ra tất cả các ps

#### 8. giám sát ps theo thời gian thực 

dùng watch để lệnh ps được cập nhật liên tục:

```
$ watch -n 1 'ps -eo pid,ppid,cmd,%mem,%cpu --sort=-%mem | head'
```

#### 9. Kiểm tra tiến trình có mức tiêu thụ tài nguyên cao nhất 

```
$ ps -eo pid,ppid,cmd,%mem,%cpu --sort=-%cpu | head
```

#### 10. hiển thị thông tin bảo mật 

xem bối cảnh bảo mật của tiến trình (dành cho [SElinux](https://bizflycloud.vn/tin-tuc/selinux-la-gi-tai-sao-ban-nen-su-dung-selinux-20181011164512648.htm))

```
$ ps -eM
```

#### 11. Các lệnh kêt hợp khác 

```
$ ps -eo comm,etime,user | grep <tên_tiến_trình>
```



## 2. top

tham khảo tại [lpi.org](https://learning.lpi.org/vi/learning-materials/101-500/103/103.5/)

- top cho thấy tiến trình đang chạy trong thời gian thực 
- top cho người dùng thực hiện một số tương tác. Mặc định được xếp theo độ chiếm dụng cpu theo tỉ lệ giảm dần

### 2.1. Các tùy chọn được sử dụng trong `top`

- một số thao tác có thể sử dụng được trong top (sắp xếp)
  - `M` - sắp xếp %Mem
  - `N` - sắp xếp theo PID
  - `T`  - sắp xếp theo thời gian
  - `P` - sắp xếp theo %CPU
  - chuyển đổi tăng dần thành giảm dần chỉ cần ấn `R`

- Các tùy chọn khác 
  - `h` cần help
  - `k` chấp dứt 1 ps
  - `r` thay dổi mức độ ưu tiên `top` sẽ hỏi bạn về giá trị `nice`. Các giá trị có thể nằm trong khoảng từ -20 đến 19, nhưng chỉ siêu người dùng (`root`) mới có thể đặt giá trị đó thành âm hoặc thấp hơn giá trị hiện tại.
  - `u` Liệt kê các tiến trình từ một người dùng cụ thể (theo mặc định, các tiến trình từ tất cả mọi người dùng đều sẽ được hiển thị).
  - `c` Hiển thị đường dẫn tuyệt đối của chương trình và phân biệt giữa tiến trình dung lượng người dùng và tiến trình dung lượng kernel (trong dấu ngoặc vuông).
  - `V` - xem cây tiến trình 
  - `t` và `m` Thay đổi giao diện của các lần đọc CPU và bộ nhớ tương ứng theo chu kỳ bốn giai đoạn: hai lần nhấn đầu tiên hiển thị thanh tiến trình, lần nhấn thứ ba ẩn thanh tiến trình và lần nhấn thứ tư đưa thanh tiến trình trở lại.
  - `W` Lưu cấu hình vào `~/.toprc`.


### 2.2. Giải thích về đầu ra của `top`

Đầu ra của `top` được chia thành hai vùng: vùng *tóm tắt* và vùng *tác vụ*.

#### 2.2.1. Vùng tóm tắt 

![image-20241106083317726](/home/phungna/.config/Typora/typora-user-images/image-20241106083317726.png)
