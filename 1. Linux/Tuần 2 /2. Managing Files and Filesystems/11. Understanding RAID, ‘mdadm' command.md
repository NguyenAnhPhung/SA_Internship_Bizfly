# Understanding RAID, ‘mdadm' command

## 1. What is RAID?

tham khảo tại [thegioimaychu.vn](https://thegioimaychu.vn/blog/tong-hop/raid-la-gi-huong-dan-lua-chon-cau-hinh-raid-p1965/)

## 2.  How to setup RAID?

tham khảo tại [blogd.net](https://blogd.net/linux/software-raid-toan-tap-tren-linux/#5.3)

tham khảo tại [linuxbabe.com](https://www.linuxbabe.com/linux-server/linux-software-raid-1-setup)

### 2.0. Cài đặt gói `mdadm`

**Kiểm tra gói `mdadm`**

```
mdadm --version
```

**Nếu gói `mdadm` không có trên hệ thống có thể cài như sau:** 

- Đối với bản phân phối Debian/Ubuntu:

  Để bắt đầu cài đặt, bạn phải thêm repo bằng cách thực hiện lệnh sau:

  ```
  add-apt-repository ppa:eugenesan/ppa
  ```

  Tiếp theo chúng ta cần cập nhật (update) hệ thống:

  ```
  apt-get update
  ```

  Chạy lệnh sau để cài đặt gói `mdadm`:

  ```
  apt-get install mdadm
  ```

- Đối với với bản phân phối RHEL/CentOS:

  Để thực hiện cài đặt gói `mdadm` chúng ta cần thực hiện cập nhật (update) hệ thống:

  ```
  yum update 
  ```

  Chạy lệnh bên dưới để thực hiện cài đặt gói `mdadm`:

  ```
  yum install mdadm
  ```

### 2.1. Hướng dẫn tạo RAID 0

**Kiểm tra thông tin ổ trên máy**

```
fdisk -l | grep sd
```

**Kiểm tra ổ cứng đã sử dụng RAID nào chưa?**

```
mdadm -E /dev/sd[a-g]
```

**Tạo phân vùng đĩa cứng**

**Tạo phân vùng trên ổ đĩa sdb**.

Chạy lệnh `fdisk /dev/sdb` để tạo phân vùng cho `sdb` và thực hiện các thao tác sau:

- Nhấn **n** để tạo phân vùng mới.
- Sau đó chọn **p** cho phân vùng chính.
- Tiếp theo chọn số phân vùng là **1** .
- Nhập giá trị ban đầu, giá trị kết thúc và nhấn phím **Enter**.
- Tiếp theo nhấn **p** để in phân vùng đã được tạo.

Thực hiện các bước sau đây để tạo Linux RAID tự động trên các phân vùng:

- Nhập **t** để chọn phân vùng.
- Nhập **l** để liệt kê các phân vùng có sẵn
- Nhập **fd** để chọn Linux RAID tự động và nhấn **Enter** để áp dụng.
- Sử dụng phím **p** để in những thay đổi.
- Cuối cùng chúng ta nhấn phím **w** lưu các thay đổi.

Tương tự như vậy cho `sdc`

**Tạo RAID 0**

```
[root@localhost ~]# mdadm -C /dev/md0 -l raid0 -n 2 /dev/sd[b-c]1
mdadm: Defaulting to version 1.2 metadata
mdadm: array /dev/md0 started.
```

- `-C`: Tạo RAID mới.
- `-l`: Level của RAID.
- `-n`: Không có thiết bị RAID.

**Kiểm tra lại RAID vừa tạo bằng các cách sau:**

```
cat /proc/mdstat
```

Qua kết quả trên cho chúng ta thấy RAID0 đã được tạo với hai phân vùng `sdb1` và `sdc1`. Chúng ta cũng có thể kiểm tra bằng lệnh bên dưới:

```
mdadm -E /dev/sd[b-c]1
```

 **Tạo file system (ext4) cho thiết bị RAID `/dev/md0`**

```
mkfs.ext4 /dev/md0
```

**gắn kết (mount point)**

```
mkdir raid0
```

chỉnh sửa trong `etc/fstab`

```
/dev/md0        /root/raid0   ext4    defaults        0 0
```

kiểm tra quá trình mount có lỗi gì không

```
mount -a
```

**Lưu cấu hình RAID**

```
mdadm -E -s -v >> /etc/mdadm.conf
```



### 2.2. Hướng dẫn tạo RAID 

**Kiểm tra thông tin ổ đĩa trên máy **

```
fdisk -l | grep sd
```

**Kiểm tra ổ cứng đã sử dụng RAID nào chưa?**

```
mdadm -E /dev/sd[a-g]
```

**Tạo phân vùng đĩa cứng**



## 3. LAB

### 3.0. Sysbench

tham khảo tại [webhostinggeeks.com](https://webhostinggeeks.com/howto/use-sysbench-measure-speed-data-reads-writes-linux/)

### 3.1. LAB

**Yêu cầu:**

Tạo 1 VM có 7 disk cùng dung lượng 

- cài đặt hệ điều hành chạy trên 2 disk, cùng softraid 1 